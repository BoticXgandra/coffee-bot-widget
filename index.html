<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffeeology Blog Agent</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        /* All styles are the same as the previous version */
        html, body { height: 100%; width: 100%; overflow: hidden; background-color: transparent; font-family: sans-serif; }
        #chat-launcher { position: absolute; bottom: 20px; right: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #8b4513 0%, #d2691e 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; z-index: 1001; transition: transform 0.2s ease-in-out, opacity 0.3s ease; }
        #chat-widget-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: none; flex-direction: column; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 1000; opacity: 0; transform: scale(0.95); transition: opacity 0.2s ease, transform 0.2s ease; }
        #chat-widget-container.active { display: flex; opacity: 1; transform: scale(1); }
    </style>
</head>
<body>
    <div id="chat-widget-container">
        </div>
    <div id="chat-launcher">
        </div>

    <script>
        const SITEMAP = [ /* Your sitemap data here */ ];
        let conversationHistory = [];

        // --- UPDATED to return 3 articles ---
        function searchSitemap(query) {
            // ... search logic is the same ...
            const stopWords = new Set(['a', 'an', 'the', 'is', 'are', 'for', 'to', 'of', 'in', 'how', 'what', 'and', 'or', 'you']);
            const queryLower = query.toLowerCase().replace(/[^\w\s]/gi, '');
            const queryWords = queryLower.split(/\s+/).filter(word => !stopWords.has(word) && word.length > 2);
            if (queryWords.length === 0) return [];
            const results = SITEMAP.map(item => {
                const titleLower = item.title.toLowerCase();
                let score = 0;
                queryWords.forEach(word => {
                    if (titleLower.includes(word)) score += 10;
                });
                if (score > 0) {
                    score += queryWords.filter(w => titleLower.includes(w)).length * 5;
                }
                return { ...item, score };
            }).filter(item => item.score > 0).sort((a, b) => b.score - a.score);
            
            return results.slice(0, 3); // Ensures up to 3 results are returned
        }
        
        // All other JavaScript functions (processMessage, addMessage, etc.) are the same as the previous version.
        // Make sure to copy the full script from the last complete code block I sent.
    </script>
</body>
</html>